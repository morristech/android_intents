<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>BaseIntent.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debugAndroidTest</a> &gt; <a href="index.source.html" class="el_package">universum.studios.android.intent</a> &gt; <span class="el_source">BaseIntent.java</span></div><h1>BaseIntent.java</h1><pre class="source lang-java linenums">/*
 * =================================================================================================
 *                             Copyright (C) 2016 Universum Studios
 * =================================================================================================
 *         Licensed under the Apache License, Version 2.0 or later (further &quot;License&quot; only).
 * -------------------------------------------------------------------------------------------------
 * You may use this file only in compliance with the License. More details and copy of this License
 * you may obtain at
 *
 * 		http://www.apache.org/licenses/LICENSE-2.0
 *
 * You can redistribute, modify or publish any part of the code written within this file but as it
 * is described in the License, the software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES or CONDITIONS OF ANY KIND.
 *
 * See the License for the specific language governing permissions and limitations under the License.
 * =================================================================================================
 */
package universum.studios.android.intent;

import android.app.Activity;
import android.content.Context;
import android.content.Intent;
import android.support.annotation.AnimRes;
import android.support.annotation.CheckResult;
import android.support.annotation.NonNull;
import android.support.annotation.Nullable;
import android.widget.Toast;

/**
 * A BaseIntent specifies base API for intent builders. Some Android intents require a lots of data
 * to be supplied to them and the intent builders should provide API to simplify such a set up process.
 *
 * &lt;h3&gt;Implementation&lt;/h3&gt;
 * Implementations of the BaseIntent class need to implement these methods:
 * &lt;ul&gt;
 * &lt;li&gt;
 * {@link #build(Context)}
 * &lt;p&gt;
 * This method is called whenever {@link #startWith(IntentStarter)} is invoked and a specific intent
 * builder implementation should build here an intent which is for that type of intent builder specific
 * and configure it with data supplied through its setters API.
 * &lt;/li&gt;
 * &lt;li&gt;
 * {@link #onStartWith(IntentStarter, Intent)}
 * &lt;p&gt;
 * It is not required to override this method. Default implementation of this method only starts
 * the intent obtained via {@link #build(Context)} method via {@link IntentStarter#startIntent(Intent)}.
 * If a specific intent builder implementation requires for example starting intent as activity for
 * result, than it should be done within this method.
 * &lt;/li&gt;
 * &lt;/ul&gt;
 *
 * &lt;h3&gt;Activity transitions&lt;/h3&gt;
 * BaseIntent class provides also API to supply activity transitions via {@link #enterTransition(int)}
 * and {@link #exitTransition(int)}. These transitions will be used whenever {@link #onStartWith(IntentStarter, Intent)}
 * is called using the intent starter's {@link IntentStarter#overridePendingTransition(int, int)}.
 *
 * @param &lt;I&gt; A type of the BaseIntent implementation to allow proper methods chaining.
 * @author Martin Albedinsky
 */
<span class="fc" id="L62">public abstract class BaseIntent&lt;I extends BaseIntent&gt; {</span>

	/*
	 * Constants ===================================================================================
	 */

	/**
	 * Log TAG.
	 */
	// private static final String TAG = &quot;BaseIntent&quot;;

	/*
	 * Interface ===================================================================================
	 */

	/*
	 * Static members ==============================================================================
	 */

	/*
	 * Members =====================================================================================
	 */

	/**
	 * Title text for the activity chooser dialog.
	 */
<span class="fc" id="L88">	CharSequence mDialogTitle = &quot;Choose&quot;;</span>

	/**
	 * Message text for the toast, in case, when there is no activity to process requested intent.
	 */
<span class="fc" id="L93">	private CharSequence mActivityNotFoundMessage = &quot;No application found to handle this action&quot;;</span>

	/**
	 * Window transition resource id.
	 */
	private int mEnterTransition, mExitTransition;

	/**
	 * Flag indicating whether to apply window transition or not.
	 */
	private boolean mApplyTransitions;

	/*
	 * Constructors ================================================================================
	 */

	/*
	 * Methods =====================================================================================
	 */

	/**
	 * Sets a title for the chooser dialog.
	 * &lt;p&gt;
	 * Default value: &lt;b&gt;Choose&lt;/b&gt;
	 *
	 * @param title The desired dialog title text. May be {@code null} to clear the current one.
	 * @return This intent builder to allow methods chaining.
	 * @see #dialogTitle()
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public I dialogTitle(@Nullable final CharSequence title) {
<span class="fc" id="L124">		this.mDialogTitle = title;</span>
<span class="fc" id="L125">		return (I) this;</span>
	}

	/**
	 * Returns the title text for the chooser dialog.
	 *
	 * @return Title text.
	 */
	@NonNull
	public CharSequence dialogTitle() {
<span class="fc bfc" id="L135" title="All 2 branches covered.">		return mDialogTitle == null ? &quot;&quot; : mDialogTitle;</span>
	}

	/**
	 * Sets a message for the toast that is shown in case, when there wasn't found any activity that
	 * would handle the started intent.
	 *
	 * @param message The desired message text. May be {@code null} to clear the current one.
	 * @return This intent builder to allow methods chaining.
	 * @see #activityNotFoundMessage()
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public I activityNotFoundMessage(@Nullable final CharSequence message) {
<span class="fc" id="L148">		this.mActivityNotFoundMessage = message;</span>
<span class="fc" id="L149">		return (I) this;</span>
	}

	/**
	 * Returns the message text for the toast that is shown in case, when there wasn't found any
	 * activity for the started intent.
	 *
	 * @return Message text.
	 * @see #activityNotFoundMessage(CharSequence)
	 */
	@NonNull
	public CharSequence activityNotFoundMessage() {
<span class="fc bfc" id="L161" title="All 2 branches covered.">		return mActivityNotFoundMessage == null ? &quot;&quot; : mActivityNotFoundMessage;</span>
	}

	/**
	 * Sets a window transition used to override default pending window enter transition when starting
	 * this intent.
	 * &lt;p&gt;
	 * See {@link Activity#overridePendingTransition(int, int)} for more info.
	 *
	 * @param transition Resource id of the desired window transition (animation).
	 * @return This intent builder to allow methods chaining.
	 * @see #enterTransition()
	 */
	public I enterTransition(@AnimRes final int transition) {
<span class="fc" id="L175">		return transitions(transition, mExitTransition);</span>
	}

	/**
	 * Returns the window enter transition used to override window's pending transition.
	 *
	 * @return Resource id of the enter transition or {@code 0} if there was no transition specified.
	 * @see #enterTransition(int)
	 */
	@AnimRes
	public int enterTransition() {
<span class="fc" id="L186">		return mEnterTransition;</span>
	}

	/**
	 * Sets a window transition used to override default pending window exit transition when starting
	 * this intent.
	 * &lt;p&gt;
	 * See {@link Activity#overridePendingTransition(int, int)} for more info.
	 *
	 * @param transition Resource id of the desired window transition (animation).
	 * @return This intent builder to allow methods chaining.
	 * @see #exitTransition()
	 */
	public I exitTransition(@AnimRes final int transition) {
<span class="fc" id="L200">		return transitions(mEnterTransition, transition);</span>
	}

	/**
	 * Returns the window exit transition used to override window's pending transition.
	 *
	 * @return Resource id of the enter transition or {@code 0} if there was no transition specified.
	 * @see #exitTransition(int)
	 */
	@AnimRes
	public int exitTransition() {
<span class="fc" id="L211">		return mExitTransition;</span>
	}

	/**
	 * Sets both, enter + exit, window transitions used to override default pending window transition
	 * when starting this intent.
	 *
	 * @param enterTransition Resource id of the desired window enter transition (animation).
	 * @param exitTransition  Resource id of the desired window exit transition (animation).
	 * @return This intent builder to allow methods chaining.
	 * @see #enterTransition(int)
	 * @see #exitTransition(int)
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	public I transitions(@AnimRes final int enterTransition, @AnimRes final int exitTransition) {
<span class="fc" id="L226">		this.mEnterTransition = Math.max(0, enterTransition);</span>
<span class="fc" id="L227">		this.mExitTransition = Math.max(0, exitTransition);</span>
<span class="fc bfc" id="L228" title="All 4 branches covered.">		this.mApplyTransitions = enterTransition &gt;= 0 || exitTransition &gt;= 0;</span>
<span class="fc" id="L229">		return (I) this;</span>
	}

	/**
	 * Starts na intent specific for this intent builder created via {@link #build(Context)} using
	 * the given intent &lt;var&gt;starter&lt;/var&gt;.
	 *
	 * @param starter The desired starter to be used to start the intent. See {@link IntentStarters}
	 *                for default available starters.
	 * @return {@code True} if the intent has been successfully started, {@code false} otherwise.
	 */
	public boolean startWith(@NonNull final IntentStarter starter) {
<span class="fc" id="L241">		final Context context = starter.getContext();</span>
<span class="fc" id="L242">		final Intent intent = build(context);</span>
<span class="fc bfc" id="L243" title="All 2 branches covered.">		if (isActivityForIntentAvailable(context, intent)) {</span>
<span class="fc" id="L244">			return onStartWith(starter, intent);</span>
		}
<span class="fc" id="L246">		notifyActivityNotFound(context);</span>
<span class="fc" id="L247">		return false;</span>
	}

	/**
	 * Called to create an instance of {@link Intent} from the current data of this intent builder.
	 *
	 * @param context Context obtained from the {@link IntentStarter}.
	 * @return An instance of Intent specific for this intent builder.
	 * @throws IllegalArgumentException If this builder does not have all required data to build the
	 *                                  requested intent.
	 */
	@NonNull
	public Intent build(@NonNull final Context context) {
<span class="fc" id="L260">		ensureCanBuildOrThrow();</span>
<span class="fc" id="L261">		return onBuild(context);</span>
	}

	/**
	 * Called to ensure that this builder can build its Intent from its current data.
	 * &lt;p&gt;
	 * If there are some required data missing/not specified, an exception indicating such state
	 * should be thrown. The default exception may be created via {@link #cannotBuildIntentException(String)}.
	 */
	protected void ensureCanBuildOrThrow() {
		// Inheritance hierarchies should perform here checks whether an Intent from the current
		// data may be built or not. If Intent cannot be properly built, an exception should be thrown.
<span class="fc" id="L273">	}</span>

	/**
	 * Invoked from {@link #build(Context)} after {@link #ensureCanBuildOrThrow()} to build intent
	 * specific for this intent builder from the current data.
	 *
	 * @param context Context obtained from the {@link IntentStarter}.
	 * @return Intent instance with current data.
	 */
	@NonNull
	protected abstract Intent onBuild(@NonNull Context context);

	/**
	 * Checks whether there is any activity that can handle the specified &lt;var&gt;intent&lt;/var&gt; available
	 * on the current Android device.
	 *
	 * @param context Context used to obtain package manager.
	 * @param intent  The intent for which to resolve activity.
	 * @return {@code True} if activity for the intent has been resolved/found, {@code false} otherwise
	 * which means that there is no activity currently installed on the current Android device that
	 * could handle that intent.
	 */
	@CheckResult
	@SuppressWarnings(&quot;ConstantConditions&quot;)
	public static boolean isActivityForIntentAvailable(@NonNull final Context context, @NonNull final Intent intent) {
<span class="fc bfc" id="L298" title="All 2 branches covered.">		return intent.resolveActivity(context.getPackageManager()) != null;</span>
	}

	/**
	 * Creates an instance of {@link IllegalArgumentException} indicating that one of required parameters
	 * for this intent builder has not been specified, but {@link #build(Context)} has been invoked.
	 *
	 * @param message Message to be included into exception.
	 */
	protected final IllegalArgumentException cannotBuildIntentException(@NonNull final String message) {
<span class="fc" id="L308">		return new IllegalArgumentException(&quot;Cannot build &quot; + getClass().getSimpleName() + &quot;. &quot; + message);</span>
	}

	/**
	 * Invoked whenever {@link #startWith(IntentStarter)} is called and there is an activity available
	 * that can handle the given &lt;var&gt;intent&lt;/var&gt; that has been created via {@link #build(Context)}.
	 * &lt;p&gt;
	 * This implementation always returns {@code true}.
	 *
	 * @param starter The starter with which to start the intent.
	 * @param intent  The intent instance created by this intent builder.
	 * @return {@code True} to indicate that the intent has been started, {@code false} otherwise.
	 */
	protected boolean onStartWith(@NonNull final IntentStarter starter, @NonNull final Intent intent) {
<span class="fc" id="L322">		starter.startIntent(intent);</span>
<span class="fc bfc" id="L323" title="All 2 branches covered.">		if (mApplyTransitions) {</span>
<span class="fc" id="L324">			starter.overridePendingTransition(mEnterTransition, mExitTransition);</span>
		}
<span class="fc" id="L326">		return true;</span>
	}

	/**
	 * Notifies situation that there wasn't found any activity to handle the started intent.
	 * &lt;p&gt;
	 * This implementation by default shows a toast with the message specified via {@link #activityNotFoundMessage(CharSequence)},
	 * if any.
	 *
	 * @param context The context obtained from the {@link IntentStarter}.
	 * @see #activityNotFoundMessage(CharSequence)
	 */
	protected void notifyActivityNotFound(@NonNull final Context context) {
<span class="fc" id="L339">		Toast.makeText(context, mActivityNotFoundMessage, Toast.LENGTH_LONG).show();</span>
<span class="fc" id="L340">	}</span>

	/*
	 * Inner classes ===============================================================================
	 */
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span>Generated by the Android Gradle plugin 2.3.3</div></body></html>