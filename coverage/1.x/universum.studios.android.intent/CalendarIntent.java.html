<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>CalendarIntent.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debugAndroidTest</a> &gt; <a href="index.source.html" class="el_package">universum.studios.android.intent</a> &gt; <span class="el_source">CalendarIntent.java</span></div><h1>CalendarIntent.java</h1><pre class="source lang-java linenums">/*
 * =================================================================================================
 *                             Copyright (C) 2016 Universum Studios
 * =================================================================================================
 *         Licensed under the Apache License, Version 2.0 or later (further &quot;License&quot; only).
 * -------------------------------------------------------------------------------------------------
 * You may use this file only in compliance with the License. More details and copy of this License 
 * you may obtain at
 * 
 * 		http://www.apache.org/licenses/LICENSE-2.0
 * 
 * You can redistribute, modify or publish any part of the code written within this file but as it 
 * is described in the License, the software distributed under the License is distributed on an 
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES or CONDITIONS OF ANY KIND.
 * 
 * See the License for the specific language governing permissions and limitations under the License.
 * =================================================================================================
 */
package universum.studios.android.intent;

import android.content.ContentUris;
import android.content.Context;
import android.content.Intent;
import android.net.Uri;
import android.provider.CalendarContract;
import android.support.annotation.IntDef;
import android.support.annotation.IntRange;
import android.support.annotation.NonNull;
import android.support.annotation.Nullable;
import android.text.TextUtils;

import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;

/**
 * A {@link BaseIntent} builder implementation providing API for building and starting of intents
 * targeting a &lt;b&gt;calendar&lt;/b&gt; related applications.
 * &lt;p&gt;
 * Whether a started calendar intent should insert a new event or edit the existing one may be
 * specified via {@link #type(int)} and supplying one of {@link #TYPE_VIEW}, {@link #TYPE_INSERT_EVENT},
 * {@link #TYPE_EDIT_EVENT}, {@link #TYPE_VIEW_EVENT}.
 *
 * &lt;h3&gt;Intent type&lt;/h3&gt;
 * &lt;ul&gt;
 * &lt;li&gt;
 * {@link #TYPE_VIEW}
 * &lt;p&gt;
 * Use this type when you want to open only calendar at the current date for preview. If you want to
 * open calendar at different date, you can specify your desired date via {@link #beginTime(long)}.
 * &lt;/li&gt;
 * &lt;li&gt;
 * {@link #TYPE_VIEW_EVENT}
 * &lt;p&gt;
 * Use this type when you want to open an existing calendar event for preview. This type requires an
 * id of the desired event to be specified via {@link #eventId(long)} otherwise calendar intent cannot
 * be build properly and {@link #build(Context)} will return {@code null}.
 * &lt;/li&gt;
 * &lt;li&gt;
 * {@link #TYPE_EDIT_EVENT}
 * &lt;p&gt;
 * Use this type when you want to open an existing calendar event for editing. This type requires an
 * id of the desired event like described for {@link #TYPE_VIEW_EVENT} above.
 * &lt;/li&gt;
 * &lt;li&gt;
 * {@link #TYPE_INSERT_EVENT}
 * &lt;p&gt;
 * Use this type when you want to create a new calendar event. This type requires a begin time to be
 * specified via {@link #beginTime(long)} and an end time via {@link #endTime(long)}. Following data
 * are relatively optional but for 'good' calendar event should be always set: {@link #title(CharSequence)},
 * {@link #description(CharSequence)}, {@link #location(CharSequence)}, {@link #availability(int)}.
 * &lt;/li&gt;
 * &lt;/ul&gt;
 *
 * @author Martin Albedinsky
 */
public class CalendarIntent extends BaseIntent&lt;CalendarIntent&gt; {

	/*
	 * Constants ===================================================================================
	 */

	/**
	 * Log TAG.
	 */
	// private static final String TAG = &quot;CalendarIntent&quot;;

	/**
	 * Flag to identify CalendarIntent as intent to open calendar. Can be passed only to {@link #type(int)}.
	 */
	public static final int TYPE_VIEW = 0x01;

	/**
	 * Flag to identify CalendarIntent as intent to create new calendar event. Can be passed only to
	 * {@link #type(int)}.
	 */
	public static final int TYPE_INSERT_EVENT = 0x02;

	/**
	 * Flag to identify CalendarIntent as intent to edit existing calendar event. Can be passed only
	 * to {@link #type(int)}.
	 */
	public static final int TYPE_EDIT_EVENT = 0x03;

	/**
	 * Flag to identify CalendarIntent as intent to view existing calendar event. Can be passed only
	 * to {@link #type(int)}.
	 */
	public static final int TYPE_VIEW_EVENT = 0x04;

	/**
	 * Defines an annotation for determining set of allowed flags for {@link #type(int)} method.
	 */
	@Retention(RetentionPolicy.SOURCE)
	@IntDef({TYPE_VIEW, TYPE_INSERT_EVENT, TYPE_EDIT_EVENT, TYPE_VIEW_EVENT})
	public @interface Type {
	}

	/**
	 * Flag to identify BUSY availability for the newly creating calendar event.
	 * See {@link CalendarContract.Events#AVAILABILITY_BUSY} for additional info.
	 */
	public static final int AVAILABILITY_BUSY = CalendarContract.Events.AVAILABILITY_BUSY;

	/**
	 * Flag to identify FREE availability for the newly creating calendar event.
	 * See {@link CalendarContract.Events#AVAILABILITY_FREE} for additional info.
	 */
	public static final int AVAILABILITY_FREE = CalendarContract.Events.AVAILABILITY_FREE;

	/**
	 * Flag to identify TENTATIVE availability for the newly creating calendar event.
	 * See {@link CalendarContract.Events#AVAILABILITY_TENTATIVE} for additional info.
	 */
	public static final int AVAILABILITY_TENTATIVE = 0x02;

	/**
	 * Defines an annotation for determining set of allowed flags for {@link #availability(int)} method.
	 */
	@Retention(RetentionPolicy.SOURCE)
	@IntDef({AVAILABILITY_BUSY, AVAILABILITY_FREE, AVAILABILITY_TENTATIVE})
	public @interface Availability {
	}

	/*
	 * Interface ===================================================================================
	 */

	/*
	 * Static members ==============================================================================
	 */

	/*
	 * Members =====================================================================================
	 */

	/**
	 * Type of intent that to be created by this builder.
	 */
<span class="fc" id="L159">	private int mType = TYPE_VIEW;</span>

	/**
	 * Id of newly creating or already existing calendar event.
	 */
<span class="fc" id="L164">	private long mEventId = -1;</span>

	/**
	 * Time for newly creating calendar event.
	 */
	private long mBeginTime, mEndTime;

	/**
	 * Title for newly creating calendar event.
	 */
	private CharSequence mTitle;

	/**
	 * Description for newly creating calendar event.
	 */
	private CharSequence mDescription;

	/**
	 * Location for newly creating calendar event.
	 */
	private CharSequence mLocation;

	/**
	 * Availability for newly creating calendar event.
	 */
<span class="fc" id="L189">	private int mAvailability = AVAILABILITY_BUSY;</span>

	/*
	 * Constructors ================================================================================
	 */

	/**
	 * Creates a new instance of CalendarIntent.
	 * &lt;p&gt;
	 * The begin time will be initially set to the current time and the end time to begin time + 1.
	 *
	 * @see #beginTime(long)
	 * @see #endTime(long)
	 */
	public CalendarIntent() {
<span class="fc" id="L204">		super();</span>
<span class="fc" id="L205">		this.mBeginTime = System.currentTimeMillis();</span>
<span class="fc" id="L206">		this.mEndTime = mBeginTime + 1;</span>
<span class="fc" id="L207">	}</span>

	/*
	 * Methods =====================================================================================
	 */

	/**
	 * Sets a type determining whether to create, view or edit an event in the calendar.
	 * &lt;p&gt;
	 * Default value: &lt;b&gt;{@link #TYPE_VIEW}&lt;/b&gt;
	 *
	 * @param type One of {@link #TYPE_VIEW}, {@link #TYPE_INSERT_EVENT}, {@link #TYPE_EDIT_EVENT},
	 *             {@link #TYPE_VIEW_EVENT}.
	 * @return This intent builder to allow methods chaining.
	 * @see #type()
	 */
	public CalendarIntent type(@Type final int type) {
<span class="fc" id="L224">		this.mType = type;</span>
<span class="fc" id="L225">		return this;</span>
	}

	/**
	 * Returns the type of the intent that will be created by this intent builder.
	 *
	 * @return One of {@link #TYPE_VIEW}, {@link #TYPE_INSERT_EVENT}, {@link #TYPE_EDIT_EVENT},
	 * {@link #TYPE_VIEW_EVENT}.
	 * @see #type(int)
	 */
	@Type
	public int type() {
<span class="fc" id="L237">		return mType;</span>
	}

	/**
	 * Sets an id of the calendar event to be edited or viewed. This id is only used in case of
	 * intent type {@link #TYPE_EDIT_EVENT} or {@link #TYPE_VIEW_EVENT}.
	 * &lt;p&gt;
	 * Default value: &lt;b&gt;{@code -1}&lt;/b&gt;
	 *
	 * @param eventId Id of the desired calendar event (to edit or view).
	 * @return This intent builder to allow methods chaining.
	 * @see #eventId()
	 * @see #type(int)
	 */
	public CalendarIntent eventId(@IntRange(from = 1, to = Long.MAX_VALUE) final long eventId) {
<span class="fc" id="L252">		this.mEventId = eventId;</span>
<span class="fc" id="L253">		return this;</span>
	}

	/**
	 * Returns the id of the event to edit or view within calendar.
	 *
	 * @return Event id.
	 * @see #eventId(long)
	 */
	public long eventId() {
<span class="fc" id="L263">		return mEventId;</span>
	}

	/**
	 * Sets a time determining where to open the calendar for view. This time is only used in case
	 * of intent type {@link #TYPE_VIEW}.
	 * &lt;p&gt;
	 * Default value: &lt;b&gt;{@link System#currentTimeMillis()}&lt;/b&gt;
	 *
	 * @param time The desired time where to open the calendar.
	 * @return This intent builder to allow methods chaining.
	 * @see #time()
	 */
	public CalendarIntent time(@IntRange(from = 0, to = Long.MAX_VALUE) final long time) {
<span class="fc" id="L277">		this.mBeginTime = time;</span>
<span class="fc" id="L278">		return this;</span>
	}

	/**
	 * Returns the time determining where to open the calendar for view.
	 *
	 * @return Time for calendar in milliseconds.
	 * @see #time(long)
	 */
	public long time() {
<span class="fc" id="L288">		return mBeginTime;</span>
	}

	/**
	 * Sets a begin time for the calendar event to be newly created. This time is only used in case
	 * of intent type {@link #TYPE_INSERT_EVENT} or {@link #TYPE_VIEW}.
	 * &lt;p&gt;
	 * Default value: &lt;b&gt;{@link System#currentTimeMillis()}&lt;/b&gt;
	 *
	 * @param beginTime The desired begin time for the new event in milliseconds.
	 * @return This intent builder to allow methods chaining.
	 * @see #endTime(long)
	 * @see #type(int)
	 * @see #beginTime()
	 */
	public CalendarIntent beginTime(@IntRange(from = 0, to = Long.MAX_VALUE) final long beginTime) {
<span class="fc" id="L304">		this.mBeginTime = beginTime;</span>
<span class="fc" id="L305">		return this;</span>
	}

	/**
	 * Returns the begin time for the new calendar event.
	 *
	 * @return Begin time for calendar event in milliseconds.
	 * @see #beginTime(long)
	 * @see #endTime(long)
	 */
	public long beginTime() {
<span class="fc" id="L316">		return mBeginTime;</span>
	}

	/**
	 * Sets an end time for the calendar event to be newly created. This time is only used in case
	 * of intent type {@link #TYPE_INSERT_EVENT}.
	 * &lt;p&gt;
	 * &lt;b&gt;Note&lt;/b&gt;, that the default end time is set to {@link #beginTime()} {@code +1}.
	 *
	 * @param endTime The desired end time for the new event in milliseconds.
	 * @return This intent builder to allow methods chaining.
	 * @see #beginTime(long)
	 * @see #type(int)
	 * @see #endTime()
	 */
	public CalendarIntent endTime(@IntRange(from = 0, to = Long.MAX_VALUE) final long endTime) {
<span class="fc" id="L332">		this.mEndTime = endTime;</span>
<span class="fc" id="L333">		return this;</span>
	}

	/**
	 * Returns the end time for the new calendar event.
	 *
	 * @return End time for calendar event in milliseconds.
	 * @see #endTime(long)
	 * @see #beginTime(long)
	 */
	public long endTime() {
<span class="fc" id="L344">		return mEndTime;</span>
	}

	/**
	 * Sets a title for the calendar event to be newly created. This text is used only in case of
	 * intent type {@link #TYPE_INSERT_EVENT} or {@link #TYPE_EDIT_EVENT}.
	 *
	 * @param title The desired title text. May be {@code null} to clear the current one.
	 * @return This intent builder to allow methods chaining.
	 * @see #title()
	 */
	public CalendarIntent title(@Nullable final CharSequence title) {
<span class="fc" id="L356">		this.mTitle = title;</span>
<span class="fc" id="L357">		return this;</span>
	}

	/**
	 * Returns the title for the new calendar event.
	 *
	 * @return Title text for calendar event.
	 * @see #title(CharSequence)
	 */
	@NonNull
	public CharSequence title() {
<span class="fc bfc" id="L368" title="All 2 branches covered.">		return mTitle == null ? &quot;&quot; : mTitle;</span>
	}

	/**
	 * Sets a description for the calendar event to be newly created. This text is only used in case
	 * of intent type {@link #TYPE_INSERT_EVENT}.
	 *
	 * @param description The desired description text. May be {@code null} to clear the current one.
	 * @return This intent builder to allow methods chaining.
	 * @see #description()
	 */
	public CalendarIntent description(@Nullable final CharSequence description) {
<span class="fc" id="L380">		this.mDescription = description;</span>
<span class="fc" id="L381">		return this;</span>
	}

	/**
	 * Returns the description for the new calendar event.
	 *
	 * @return Description text for calendar event.
	 * @see #description(CharSequence)
	 */
	@NonNull
	public CharSequence description() {
<span class="fc bfc" id="L392" title="All 2 branches covered.">		return mDescription == null ? &quot;&quot; : mDescription;</span>
	}

	/**
	 * Sets a location for the calendar event to be newly created. This text is only used in case of
	 * intent type {@link #TYPE_INSERT_EVENT}.
	 *
	 * @param location The desired location text. May be {@code null} to clear the current one.
	 * @return This intent builder to allow methods chaining.
	 * @see #location()
	 */
	public CalendarIntent location(@Nullable final CharSequence location) {
<span class="fc" id="L404">		this.mLocation = location;</span>
<span class="fc" id="L405">		return this;</span>
	}

	/**
	 * Returns the location for the new calendar event.
	 *
	 * @return Location text for calendar event.
	 * @see #location(CharSequence)
	 */
	@NonNull
	public CharSequence location() {
<span class="fc bfc" id="L416" title="All 2 branches covered.">		return mLocation == null ? &quot;&quot; : mLocation;</span>
	}

	/**
	 * Sets an availability flag for the calendar event to be newly created. This flag is used only
	 * in case of intent type {@link #TYPE_INSERT_EVENT}.
	 * &lt;p&gt;
	 * Default value: &lt;b&gt;{@link #AVAILABILITY_BUSY}&lt;/b&gt;
	 *
	 * @param availability One of {@link #AVAILABILITY_BUSY}, {@link #AVAILABILITY_FREE} or {@link #AVAILABILITY_TENTATIVE}.
	 * @return This intent builder to allow methods chaining.
	 * @see #availability()
	 */
	public CalendarIntent availability(@Availability final int availability) {
<span class="fc" id="L430">		this.mAvailability = availability;</span>
<span class="fc" id="L431">		return this;</span>
	}

	/**
	 * Returns the availability flag for the new calendar event.
	 * &lt;p&gt;
	 * Default value: &lt;b&gt;{@link #AVAILABILITY_BUSY}&lt;/b&gt;
	 *
	 * @return Availability flag. One of {@link #AVAILABILITY_BUSY}, {@link #AVAILABILITY_FREE} or
	 * {@link #AVAILABILITY_TENTATIVE}.
	 * @see #availability(int)
	 */
	@Availability
	public int availability() {
<span class="fc" id="L445">		return mAvailability;</span>
	}

	/**
	 */
	@Override
	protected void ensureCanBuildOrThrow() {
<span class="fc" id="L452">		super.ensureCanBuildOrThrow();</span>
<span class="fc bfc" id="L453" title="All 3 branches covered.">		switch (mType) {</span>
			case TYPE_VIEW:
<span class="fc bfc" id="L455" title="All 2 branches covered.">				if (mBeginTime &lt; 0) {</span>
<span class="fc" id="L456">					throw cannotBuildIntentException(</span>
							&quot;Specified invalid time(&quot; + mBeginTime + &quot;) where to open calendar for view. &quot; +
									&quot;Must be none-negative time value.&quot;
					);
				}
				break;
			case TYPE_INSERT_EVENT:
<span class="fc bfc" id="L463" title="All 2 branches covered.">				if (mBeginTime &lt; 0) {</span>
<span class="fc" id="L464">					throw cannotBuildIntentException(</span>
							&quot;Specified invalid begin time(&quot; + mBeginTime + &quot;). &quot; +
									&quot;Must be none-negative time value.&quot;
					);
				}
<span class="fc bfc" id="L469" title="All 2 branches covered.">				if (mEndTime &lt; 0) {</span>
<span class="fc" id="L470">					throw cannotBuildIntentException(</span>
							&quot;Specified invalid end time(&quot; + mEndTime + &quot;). &quot; +
									&quot;Must be none-negative time value.&quot;
					);
				}
<span class="fc bfc" id="L475" title="All 2 branches covered.">				if (mEndTime &lt;= mBeginTime) {</span>
<span class="fc" id="L476">					throw cannotBuildIntentException(</span>
							&quot;Specified end time(&quot; + mEndTime + &quot;) is before/at begin time(&quot; + mBeginTime + &quot;). &quot; +
									&quot;Must be greater than the begin time.&quot;
					);
				}
				break;
			case TYPE_EDIT_EVENT:
			case TYPE_VIEW_EVENT:
			default:
<span class="fc bfc" id="L485" title="All 2 branches covered.">				if (mEventId &lt;= 0) {</span>
<span class="fc" id="L486">					throw cannotBuildIntentException(&quot;Specified invalid event id(&quot; + mEventId + &quot;).&quot;);</span>
				}
				break;
		}
<span class="fc" id="L490">	}</span>

	/**
	 */
	@NonNull
	@Override
	@SuppressWarnings(&quot;ConstantConditions&quot;)
	protected Intent onBuild(@NonNull final Context context) {
<span class="fc bfc" id="L498" title="All 4 branches covered.">		switch (mType) {</span>
			case TYPE_VIEW:
<span class="fc" id="L500">				final Uri.Builder builder = CalendarContract.CONTENT_URI.buildUpon();</span>
<span class="fc" id="L501">				builder.appendPath(&quot;time&quot;);</span>
<span class="fc" id="L502">				ContentUris.appendId(builder, mBeginTime);</span>
<span class="fc" id="L503">				return new Intent(Intent.ACTION_VIEW).setData(builder.build());</span>
			case TYPE_INSERT_EVENT:
<span class="fc" id="L505">				return new Intent(Intent.ACTION_INSERT)</span>
<span class="fc" id="L506">						.setData(CalendarContract.Events.CONTENT_URI)</span>
<span class="fc" id="L507">						.putExtra(CalendarContract.EXTRA_EVENT_BEGIN_TIME, mBeginTime)</span>
<span class="fc" id="L508">						.putExtra(CalendarContract.EXTRA_EVENT_END_TIME, mEndTime)</span>
<span class="fc" id="L509">						.putExtra(CalendarContract.Events.TITLE, mTitle)</span>
<span class="fc" id="L510">						.putExtra(CalendarContract.Events.DESCRIPTION, mDescription)</span>
<span class="fc" id="L511">						.putExtra(CalendarContract.Events.EVENT_LOCATION, mLocation)</span>
<span class="fc" id="L512">						.putExtra(CalendarContract.Events.AVAILABILITY, mAvailability);</span>
			case TYPE_EDIT_EVENT:
<span class="fc" id="L514">				final Intent intent = new Intent(Intent.ACTION_EDIT);</span>
<span class="fc" id="L515">				intent.setData(ContentUris.withAppendedId(CalendarContract.Events.CONTENT_URI, mEventId));</span>
<span class="fc bfc" id="L516" title="All 2 branches covered.">				if (!TextUtils.isEmpty(mTitle)) {</span>
<span class="fc" id="L517">					intent.putExtra(CalendarContract.Events.TITLE, mTitle);</span>
				}
<span class="fc" id="L519">				return intent;</span>
			default:
<span class="fc" id="L521">				return new Intent(Intent.ACTION_VIEW).setData(</span>
<span class="fc" id="L522">						ContentUris.withAppendedId(CalendarContract.Events.CONTENT_URI, mEventId)</span>
				);
		}
	}

	/*
	 * Inner classes ===============================================================================
	 */
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span>Generated by the Android Gradle plugin 2.3.3</div></body></html>