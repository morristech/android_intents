<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>VideoIntent.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debugAndroidTest</a> &gt; <a href="index.source.html" class="el_package">universum.studios.android.intent</a> &gt; <span class="el_source">VideoIntent.java</span></div><h1>VideoIntent.java</h1><pre class="source lang-java linenums">/*
 * =================================================================================================
 *                             Copyright (C) 2016 Universum Studios
 * =================================================================================================
 *         Licensed under the Apache License, Version 2.0 or later (further &quot;License&quot; only).
 * -------------------------------------------------------------------------------------------------
 * You may use this file only in compliance with the License. More details and copy of this License
 * you may obtain at
 *
 * 		http://www.apache.org/licenses/LICENSE-2.0
 *
 * You can redistribute, modify or publish any part of the code written within this file but as it
 * is described in the License, the software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES or CONDITIONS OF ANY KIND.
 *
 * See the License for the specific language governing permissions and limitations under the License.
 * =================================================================================================
 */
package universum.studios.android.intent;

import android.app.Activity;
import android.content.Context;
import android.content.Intent;
import android.content.res.Resources;
import android.net.Uri;
import android.os.Environment;
import android.provider.MediaStore;
import android.support.annotation.NonNull;
import android.support.annotation.Nullable;

import java.io.File;

/**
 * A {@link ContentIntent} implementation providing API for building and starting of intents to obtain
 * or preview a video content.
 *
 * @author Martin Albedinsky
 */
<span class="fc" id="L39">public class VideoIntent extends ContentIntent&lt;VideoIntent&gt; {</span>

	/*
	 * Constants ===================================================================================
	 */

	/**
	 * Log TAG.
	 */
	// private static final String TAG = &quot;VideoIntent&quot;;

	/**
	 * Flag to identify request code used to obtain video from gallery.
	 */
	public static final int REQUEST_CODE_GALLERY = 0x5011;

	/**
	 * Flag to identify request code used to obtain video using camera.
	 */
	public static final int REQUEST_CODE_CAMERA = 0x5012;

	/**
	 * Default format for video file name.
	 * &lt;p&gt;
	 * Constant value: &lt;b&gt;VIDEO_%s&lt;/b&gt;
	 */
	public static final String VIDEO_FILE_NAME_FORMAT = &quot;VIDEO_%s&quot;;

	/*
	 * Interface ===================================================================================
	 */

	/*
	 * Static members ==============================================================================
	 */

	/*
	 * Members =====================================================================================
	 */

	/**
	 * Camera intent handler.
	 */
	private ContentHandler mCameraHandler;

	/*
	 * Constructors ================================================================================
	 */

	/*
	 * Methods =====================================================================================
	 */

	/**
	 * Creates a new instance of Intent with {@link Intent#ACTION_GET_CONTENT} and {@link MimeType#VIDEO}
	 * MIME type that can be used to launch a gallery app (depends on user's choice) to pick one of
	 * available videos.
	 *
	 * @return New gallery intent instance.
	 */
	@NonNull
	public static Intent createGalleryIntent() {
<span class="fc" id="L101">		return new Intent(Intent.ACTION_GET_CONTENT).setType(MimeType.VIDEO);</span>
	}

	/**
	 * Same as {@link #createCameraIntent(File)} with {@code null} for &lt;var&gt;outputFile&lt;/var&gt;
	 * parameter.
	 */
	@NonNull
	public static Intent createCameraIntent() {
<span class="fc" id="L110">		return createCameraIntent((Uri) null);</span>
	}

	/**
	 * Same as {@link #createCameraIntent(Uri)} with &lt;var&gt;outputUri&lt;/var&gt; created from the given
	 * &lt;var&gt;outputFile&lt;/var&gt; if not {@code null}.
	 *
	 * @param outputFile The desired file used to crate the output Uri.
	 * @see #createCameraIntent()
	 */
	@NonNull
	public static Intent createCameraIntent(@Nullable final File outputFile) {
<span class="fc bfc" id="L122" title="All 2 branches covered.">		return createCameraIntent(outputFile == null ? null : Uri.fromFile(outputFile));</span>
	}

	/**
	 * Creates a new instance of Intent with {@link MediaStore#ACTION_VIDEO_CAPTURE} that can be used
	 * to launch a camera app to capture a single video.
	 *
	 * @param outputUri If not {@code null}, it will be attached to intent as {@link MediaStore#EXTRA_OUTPUT},
	 *                  so when the result is received in for example {@link Activity#onActivityResult(int, int, Intent)},
	 *                  the &lt;var&gt;outputUri&lt;/var&gt; will address to a file which contains the currently
	 *                  captured video.
	 * @return New camera intent instance.
	 * @see #createCameraIntent(File)
	 */
	@NonNull
	public static Intent createCameraIntent(@Nullable final Uri outputUri) {
<span class="fc" id="L138">		final Intent intent = new Intent(MediaStore.ACTION_VIDEO_CAPTURE);</span>
<span class="fc bfc" id="L139" title="All 2 branches covered.">		if (outputUri != null) {</span>
<span class="fc" id="L140">			intent.putExtra(MediaStore.EXTRA_OUTPUT, outputUri);</span>
		}
<span class="fc" id="L142">		return intent;</span>
	}

	/**
	 * Same as {@link #createVideoFile(String)} with &lt;var&gt;fileName&lt;/var&gt; in {@link #VIDEO_FILE_NAME_FORMAT}
	 * format with the current time stamp provided by {@link #createContentFileTimeStamp() }.
	 */
	@Nullable
	public static File createVideoFile() {
<span class="fc" id="L151">		return createVideoFile(String.format(VIDEO_FILE_NAME_FORMAT, createContentFileTimeStamp()));</span>
	}

	/**
	 * Same as {@link #createContentFile(String,  String)} with &lt;b&gt;.mp4&lt;/b&gt; suffix for the specified
	 * &lt;var&gt;fileName&lt;/var&gt; (if it does not contain any) and {@link Environment#DIRECTORY_MOVIES} as
	 * &lt;var&gt;externalDirectoryType&lt;/var&gt;.
	 *
	 * @param fileName The desired name for the video file.
	 * @see #createVideoFile()
	 */
	@Nullable
	public static File createVideoFile(@NonNull final String fileName) {
<span class="fc" id="L164">		return createContentFile(appendDefaultFileSuffixIfNotPresented(fileName, &quot;.mp4&quot;), Environment.DIRECTORY_MOVIES);</span>
	}

	/**
	 * Adds two default {@link ContentHandler}s. One for {@link #REQUEST_CODE_GALLERY} and second one
	 * for {@link #REQUEST_CODE_CAMERA}.
	 */
	@Override
	@SuppressWarnings(&quot;ConstantConditions&quot;)
	public VideoIntent withDefaultHandlers(@NonNull final Context context) {
<span class="fc" id="L174">		withHandlers(</span>
<span class="fc" id="L175">				onCreateGalleryHandler(context.getResources()),</span>
<span class="fc" id="L176">				mCameraHandler = onCreateCameraHandler(context.getResources())</span>
		);
<span class="fc bfc" id="L178" title="All 2 branches covered.">		if (mUri == null) {</span>
<span class="fc" id="L179">			mCameraHandler.intent.removeExtra(MediaStore.EXTRA_OUTPUT);</span>
		} else {
<span class="fc" id="L181">			mCameraHandler.intent.putExtra(MediaStore.EXTRA_OUTPUT, mUri);</span>
		}
<span class="fc" id="L183">		return this;</span>
	}

	/**
	 * Invoked from {@link #withDefaultHandlers(Context)} to create gallery intent handler.
	 * &lt;p&gt;
	 * This method may be override to create a handler with a localized name.
	 *
	 * @param resources Application resources.
	 * @return Content handler with gallery intent.
	 * @see #onCreateCameraHandler(Resources)
	 */
	@NonNull
	protected ContentHandler onCreateGalleryHandler(@NonNull final Resources resources) {
<span class="fc" id="L197">		return new ContentHandler(</span>
				&quot;Gallery&quot;,
<span class="fc" id="L199">				createGalleryIntent()</span>
<span class="fc" id="L200">		).requestCode(REQUEST_CODE_GALLERY);</span>
	}

	/**
	 * Invoked from {@link #withDefaultHandlers(Context)} to create camera intent handler.
	 * &lt;p&gt;
	 * This method may be override to create a handler with a localized name.
	 *
	 * @param resources Application resources.
	 * @return Content handler with camera intent.
	 * @see #onCreateGalleryHandler(Resources)
	 */
	@NonNull
	protected ContentHandler onCreateCameraHandler(@NonNull final Resources resources) {
<span class="fc" id="L214">		return new ContentHandler(</span>
				&quot;Camera&quot;,
<span class="fc" id="L216">				createCameraIntent()</span>
<span class="fc" id="L217">		).requestCode(REQUEST_CODE_CAMERA);</span>
	}

	/**
	 * If the passed &lt;var&gt;uri&lt;/var&gt; is not {@code null}, the current data (MIME) type will be by
	 * default set to {@link MimeType#VIDEO}.
	 */
	@Override
	public VideoIntent input(@Nullable Uri uri) {
<span class="fc" id="L226">		super.input(uri);</span>
<span class="fc bfc" id="L227" title="All 2 branches covered.">		if (uri != null) {</span>
<span class="fc" id="L228">			this.mDataType = MimeType.VIDEO;</span>
		}
<span class="fc" id="L230">		return this;</span>
	}

	/**
	 * Sets an output uri for a video to be captured by the camera.
	 *
	 * @param uri If not {@code null}, it will be attached to {@link ContentHandler} holding intent
	 *            with the {@link #REQUEST_CODE_CAMERA} request code, so when the camera handler's
	 *            item will be selected within a &lt;b&gt;chooser dialog&lt;/b&gt; and user confirms his captured
	 *            video, result for this action will be received in for example {@link Activity#onActivityResult(int, int, Intent)}.
	 *            The passed &lt;var&gt;uri&lt;/var&gt; will then address to a file which contains the currently
	 *            captured video.
	 * @return This intent builder to allow methods chaining.
	 */
	@Override
	public VideoIntent output(@Nullable final Uri uri) {
<span class="fc" id="L246">		super.output(uri);</span>
<span class="fc bfc" id="L247" title="All 2 branches covered.">		if (mCameraHandler != null) {</span>
<span class="fc bfc" id="L248" title="All 2 branches covered.">			if (mUri == null) {</span>
<span class="fc" id="L249">				mCameraHandler.intent.removeExtra(MediaStore.EXTRA_OUTPUT);</span>
			} else {
<span class="fc" id="L251">				mCameraHandler.intent.putExtra(MediaStore.EXTRA_OUTPUT, mUri);</span>
			}
		}
<span class="fc" id="L254">		return this;</span>
	}

	/*
	 * Inner classes ===============================================================================
	 */
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span>Generated by the Android Gradle plugin 2.3.1</div></body></html>